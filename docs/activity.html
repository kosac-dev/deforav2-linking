<!DOCTYPE html>
<html style="height: 100%;">
<head>
    <meta charset="UTF-8">
    <title>Defora - Activity Link</title>

    <!-- 합쳐지고 최소화된 최신 CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- 부가적인 테마 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

    <!-- 합쳐지고 최소화된 최신 자바스크립트 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <!-- Script -->
    <script>
    

    /**
    * 페이지 로딩이 되면 모바일앱에 Approval Access 정보를 요청한다.
    */
    document.addEventListener("DOMContentLoaded", function(event) 
    {
      getTokenParams();
    }

    /**
    * 페이지 호출시 파라미터 값을 추출하여, 요청 파라미터 값을 설정
    */
    function getTokenParams() {
        progress(">>> getTokenParams Analyzing...");

        //get Authorization code
        var url_string = window.location.href; // www.test.com?filename=test
        var url = new URL(url_string);
        var pgToken = url.searchParams.get("link_path");

        return params;
    }

    function request(params)
    {
        progress(">>> Request ");
        progress(params);
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() { // 요청에 대한 콜백
            if (xhr.readyState === xhr.DONE) { // 요청이 완료되면
                progress(">>> Recevied Responsed");
                if (xhr.status === 200 || xhr.status === 201) 
                {
                    var responseJsonData = xhr.responseJsonData;
                    progress(">>> Recevied Responsed ok");
                    progress(responseJsonData);
                } else
                {
                    progress(`#### Recevied Bad Response ####`);
                    errorNotice("예기치 못한 에러 발생, 창을 닫고 다시 시도 부탁 드립니다("+xhr.status+","+xhr.responseText+")", true);
                }
            }
        }
        
        xhr.open('POST', 'url', true); // 메소드와 주소 설정
        // xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(params)); // 데이터를 stringify해서 보냄

        progress(">>> Request Payment Appoval...");
    }

    /**
    * 에러 발생 시, Notice 및 Close 버튼 활성화
    */
    function errorNotice(msg, isClose) 
    {
        document.getElementById("errorNotice").innerText = msg;

        if (isClose) { document.getElementById("closeArea").style.display = "inline-block"; }
    }

    /**
    * 에러 발생 시, Notice 및 Close 버튼 활성화
    */
    function progress(msg) 
    {
        document.getElementById("progress").innerText += '\n'+msg;
    }

    </script>
</head>

<body style="height: 100%; display: flex; flex-direction: column; justify-content: space-around; background-color: lightgray; margin-top: 10%; margin-bottom: 10%;">
    <div style="align-content: center;">
        <h2 style="font-size: 53pt; text-align: center;">Defora Activity Share</h2>
    </div>
    <div>
        <p id="errorNotice" style="color:red"></p>
    </div>
    <div>
        <p id="notice" style="color:blue"></p>
    </div>
    <div>
        <p id="code"></p>
        <p id="cid"></p>
        <p id="cid_secret"></p>
        <p id="tid"></p>
        <p id="sid"></p>
    </div>
    <div style="text-align: center;">
        <button type="button" class="btn btn-info btn-lg btn-block" style="font-size:40px;" onclick="javascript:window.close()">닫기</button>
    </div>
    <div>
        <p id="progress" style="color:black"></p>
    </div>
</body>
</html>